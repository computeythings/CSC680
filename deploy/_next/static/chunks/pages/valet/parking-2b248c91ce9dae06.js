(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[651],{924:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/valet/parking",function(){return a(3327)}])},1912:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(7876),s=a(4232),r=a(2101),n=a.n(r);let c=e=>{let{number:t}=e,a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{a.current&&n()(a.current,t,{format:"CODE128",lineColor:"#000",width:2,height:60,displayValue:!1})},[t]),t)?(0,l.jsx)("svg",{ref:a,className:"mx-auto"}):null}},3327:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var l=a(7876),s=a(4598),r=a(5),n=a(9099),c=a(4232),i=a(3610),o=a(4587),d=a.n(o);function u(e){let{spot:t,upperRow:a,onClick:s}=e,r=(0,c.useRef)(null);return(0,l.jsxs)("div",{ref:r,onClick:e=>{e.stopPropagation(),r.current&&s(t,{top:r.current.getBoundingClientRect().top,left:r.current.getBoundingClientRect().left})},className:"flex text-3xl font-bold cursor-pointer h-30 w-20 ".concat(t.slip_id?t.carwash&&!t.washed?"bg-amber-900":"bg-red-500":"bg-green-500"," border-x-2 ").concat(a?"border-b-2 flex-col-reverse":"border-t-2 flex-col"),children:[t.spot,t.carwash&&!t.washed?(0,l.jsx)(d(),{src:"/images/carwash.png",alt:"Carwash Due",width:48,height:48,className:"mx-auto py-4"}):null]})}var h=a(1912);function x(e){let{slip_id:t,start:a,end:s,carwash:r,carwashed:n,onClick:c}=e,i=e=>{let t=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),a=e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).toUpperCase().replace(/,/g,"");return"".concat(t," ").concat(a)},o=()=>s.getTime()-a.getTime();return(0,l.jsxs)("div",{className:"mx-auto w-120",style:{fontFamily:"Consolas"},children:[(0,l.jsx)("h1",{className:"font-bold text-3xl mb-4",children:"ACME Parking"}),(0,l.jsxs)("div",{className:"grid grid-cols-[2fr_3fr] text-left gap-x-12",children:[(0,l.jsx)("div",{className:"text-right",children:"Time Entered:"}),(0,l.jsx)("div",{children:i(a)}),(0,l.jsx)("div",{className:"text-right",children:"Time Exited:"}),(0,l.jsx)("div",{children:i(s)}),(0,l.jsx)("div",{className:"text-right",children:"Total Duration:"}),(0,l.jsx)("div",{children:(e=>{let t=e/1e3,a=Math.floor(t/3600),l=Math.floor(t%3600/60);return"".concat(a," hours ").concat(l," minutes")})(o())}),(0,l.jsx)("div",{className:"text-right",children:"Cost per hour:"}),(0,l.jsx)("div",{children:"$1"}),r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-right",children:"Carwash:"}),(0,l.jsx)("div",{children:"".concat(n?"$30":"$0")})]}):null,(0,l.jsxs)("div",{className:"text-center mt-12 col-span-2",children:[(0,l.jsx)("span",{className:"font-bold pr-4",children:"TOTAL: "}),(()=>{let e=Math.ceil(o()/1e3/3600);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e+30*!!n)})()]}),(0,l.jsx)("div",{className:"col-span-2",children:(0,l.jsx)(h.A,{number:t.padStart(12,"0")})})]}),(0,l.jsx)("button",{onClick:c,className:"border hover:shadow-sm px-4",children:"Pay"})]})}function m(e){let{top:t,left:a,info:s,onUpdate:n,onClose:i}=e,o=(0,c.useRef)(null),[d,u]=(0,c.useState)(null),h=e=>{e.stopPropagation()};return o.current&&(o.current.checked=!1),(0,l.jsxs)("div",{className:"absolute z-50 bg-white p-4 border cursor-default",style:{top:t,left:a},onClick:h,children:[(0,l.jsx)("button",{onClick:i,className:"absolute top-0 right-2 text-gray-500 hover:text-gray-800 cursor-pointer text-2xl","aria-label":"Close",children:"\xd7"}),(0,l.jsxs)("div",{className:"text-lg flex flex-col",children:[s.slip_id?(0,l.jsxs)("div",{className:"min-w-50 min-h-30",children:[(0,l.jsxs)("div",{className:"font-bold",children:["Parking Slip #",s.slip_id.toString().padStart(6,"0")]}),(0,l.jsxs)("div",{children:["Customer: ",s.firstname," ",s.lastname]}),(0,l.jsxs)("div",{children:["License Plate: ",s.licenseplate]}),(0,l.jsxs)("div",{className:"flex mx-4 mt-2",children:[s.carwash&&!s.washed?(0,l.jsx)("button",{onClick:()=>{r.$C.washVehicle(s.slip_id).then(e=>{200==e.statusCode?n():alert("Unable to contact server. Cannot park new vehicle.")}),i()},className:"border hover:shadow-sm px-2 mx-auto",children:"Wash"}):null,(0,l.jsx)("button",{onClick:()=>{r.$C.customerCheckout(s.slip_id).then(e=>{if(200==e.statusCode){let t=e.data.data,a=new Date("".concat(t.end,"Z"));u({start:new Date("".concat(t.start,"Z")),end:a}),n()}else alert("Unable to contact server. Cannot park new vehicle.")})},className:"border hover:shadow-sm px-2 mx-auto",children:"Checkout"})]})]}):(0,l.jsxs)("div",{className:"w-40 h-30",children:["Space Available",(()=>{let e=new Date().getHours();return e>=8&&e<16})()?(0,l.jsxs)("div",{className:"py-4 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",ref:o,className:"h-4 w-4 cursor-pointer mr-2"}),(0,l.jsx)("span",{children:"Car Wash"})]}):(0,l.jsx)("div",{className:"text-gray-400 text-sm py-4",children:"-- Car wash unavailable --"}),(0,l.jsx)("button",{onClick:()=>{let e=!!o.current&&o.current.checked;r.$C.newParkingSlip(s.slot_id,e).then(e=>{200==e.statusCode?n():alert("Unable to contact server. Cannot park new vehicle.")}),i()},className:"border cursor-pointer my-auto py-1 px-2",children:"Park Vehicle"})]}),d?(0,l.jsx)("div",{className:"absolute z-100 bg-white p-4 border cursor-default",style:{top:-100,left:-100},onClick:h,children:(0,l.jsx)(x,{slip_id:s.slip_id.toString(),start:d.start,end:d.end,carwash:s.carwash,carwashed:s.washed,onClick:()=>{u(null),i()}})}):null]})]})}function p(){let{user:e}=(0,s.A)(),t=(0,n.useRouter)(),[a,o]=(0,c.useState)(!0),[d,h]=(0,c.useState)(-1),[x,p]=(0,c.useState)([]),[v,f]=(0,c.useState)([]),[g,j]=(0,c.useState)(null),[w,b]=(0,c.useState)({top:0,left:0});if((0,c.useEffect)(()=>{o(!1)},[e,t]),a)return null;if(!e)return localStorage.setItem("redirect","/valet/parking/"),t.push("/login/"),null;localStorage.removeItem("redirect");let N=(e,t)=>{if(g===e)return j(null);let a=e.slip_id?300:120,l=e.slip_id?-80:-40,s=40;t.top+s+150>window.innerHeight&&(s=-120),t.left+l+a>window.innerWidth&&(l=-120),b({top:t.top+s+window.scrollY,left:t.left+l+window.scrollX}),j(e)},C=()=>{j(null)};return(0,l.jsx)("div",{className:"w-full content-center min-w-300",onClick:C,children:(0,l.jsx)("div",{className:"bg-white mx-auto gap-4 text-black w-3/4 border",children:(0,l.jsxs)("div",{className:"flex flex-col w-full text-center",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold my-4",children:"VALET"}),(0,l.jsx)(i.A,{selectedLot:d,onLotSelect:e=>{let t=Number(e.target.value);h(t),r.nV.getLot(t).then(e=>{200==e.statusCode?p(e.data.data):alert("Could not load data")}),r.$C.getLot(t).then(e=>{200==e.statusCode?f(e.data.data):alert("Could not load data")})}}),(0,l.jsxs)("div",{className:"flex flex-col m-4 ".concat(x.length>0?"":"hidden"),children:[(0,l.jsx)("div",{className:"font-bold text-xl",children:"Available Spaces:"}),(0,l.jsx)("div",{className:"flex mx-auto divide-x",children:[...x.reduce((e,t)=>(e.get(t.level)||e.set(t.level,[]),e.get(t.level).push(t),e),new Map).entries()].map(e=>{let[t,a]=e;return(0,l.jsxs)("div",{className:"flex px-4",children:[(0,l.jsx)("div",{className:"font-bold",children:"Floor ".concat(t,":")}),(0,l.jsx)("div",{className:"pl-2 ".concat(a.some(e=>null===e.parked)?"":"text-red-500 font-bold"),children:a.filter(e=>null===e.parked).length})]},t)})}),(0,l.jsx)("div",{className:"mx-auto",children:(0,l.jsx)("div",{className:"grid grid-cols-10",children:v.map((e,t)=>(0,l.jsxs)("div",{children:[(0,l.jsx)(u,{spot:e,upperRow:Math.floor(t/10)%2==1,onClick:N}),(t+11)%20==0?(0,l.jsx)("div",{className:"py-8 col-span-10"}):null]},e.spot))})})]}),g?(0,l.jsx)("div",{children:(0,l.jsx)(m,{top:w.top,left:w.left,info:g,onUpdate:()=>{r.nV.getLot(d).then(e=>{200==e.statusCode?p(e.data.data):alert("Could update server data")}),r.$C.getLot(d).then(e=>{200==e.statusCode?f(e.data.data):alert("Could not update server data")})},onClose:C})}):null]})})})}function v(){return(0,l.jsx)(p,{})}},3610:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var l=a(7876),s=a(5),r=a(4232);function n(e){let{selectedLot:t,onLotSelect:a}=e,[n,c]=(0,r.useState)([]);return(0,r.useEffect)(()=>{s.nV.getLots().then(e=>{200==e.statusCode?c(e.data.data):alert("Unable to connect to server.")})},[]),(0,l.jsxs)("div",{className:"flex items-center justify-center relative p-4",children:[(0,l.jsx)("span",{className:"float-right",children:"Parking Lot:"}),(0,l.jsxs)("select",{value:t,onChange:a,className:"p-1 border min-w-80",children:[(0,l.jsx)("option",{value:-1,disabled:!0,hidden:!0,children:"-- Select a Lot --"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:"".concat(e.street," ").concat(e.city,", ").concat(e.state," ").concat(e.zip_code)},e.id))]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[647,587,636,593,792],()=>t(924)),_N_E=e.O()}]);